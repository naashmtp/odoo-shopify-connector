# Shopify Integration pour Odoo 16

Module complet d'int√©gration Shopify pour Odoo 16 d√©velopp√© pour offrir une synchronisation bidirectionnelle compl√®te entre Shopify et Odoo.

## üöÄ Fonctionnalit√©s

### 1. Configuration & Authentification
- ‚úÖ Gestion multi-instances Shopify
- ‚úÖ Authentification OAuth et API
- ‚úÖ Assistant de configuration en 4 √©tapes
- ‚úÖ Test de connexion et validation des credentials
- ‚úÖ Configuration automatique des webhooks

### 2. Gestion des Produits
- ‚úÖ Import/Export de produits avec variantes et images
- ‚úÖ Synchronisation des stocks multi-entrep√¥ts
- ‚úÖ Gestion des prix et listes de prix
- ‚úÖ Mapping par SKU et gestion des attributs
- ‚úÖ Support des images produits

### 3. Gestion des Commandes
- ‚úÖ Import automatique des commandes
- ‚úÖ Workflow de traitement automatis√©
- ‚úÖ Gestion des statuts et suivi
- ‚úÖ Support des commandes partielles
- ‚úÖ Cr√©ation automatique des bons de commande Odoo

### 4. Gestion des Clients
- ‚úÖ Synchronisation des clients et adresses
- ‚úÖ Gestion des tags et types de clients
- ‚úÖ Support des adresses multiples
- ‚úÖ Cr√©ation automatique des partenaires Odoo

### 5. Gestion Financi√®re
- ‚úÖ Import des virements Shopify
- ‚úÖ R√©conciliation automatique des paiements
- ‚úÖ Gestion des remboursements et avoirs
- ‚úÖ Cr√©ation automatique des factures

### 6. Webhooks
- ‚úÖ Configuration automatique des webhooks
- ‚úÖ Traitement en temps r√©el des √©v√©nements
- ‚úÖ Validation des signatures
- ‚úÖ Logs d√©taill√©s des appels

### 7. Planificateurs et Files d'attente
- ‚úÖ Jobs automatis√©s pour la synchronisation
- ‚úÖ Gestion des erreurs et reprises
- ‚úÖ Monitoring des performances
- ‚úÖ Syst√®me de queue avec priorit√©s

### 8. Rapports et Analytique
- ‚úÖ Tableaux de bord KPI
- ‚úÖ Rapports de ventes et profits
- ‚úÖ Analytics des canaux de vente
- ‚úÖ Dashboard temps r√©el

## üì¶ Installation

### Pr√©requis

- Odoo 16.0
- Python 3.8+
- Biblioth√®ques Python requises :
  - `requests`

```bash
pip install requests
```

### Installation du module

1. Copiez le module dans le dossier addons d'Odoo :
```bash
cp -r shopify_integration /path/to/odoo/addons/
```

2. Red√©marrez le serveur Odoo :
```bash
sudo systemctl restart odoo
```

3. Activez le mode d√©veloppeur dans Odoo

4. Allez dans Apps > Mettre √† jour la liste des applications

5. Recherchez "Shopify Integration" et cliquez sur Installer

## ‚öôÔ∏è Configuration

### √âtape 1 : Cr√©er une application priv√©e dans Shopify

1. Connectez-vous √† votre boutique Shopify
2. Allez dans Settings > Apps and sales channels > Develop apps
3. Cliquez sur "Create an app"
4. Donnez un nom √† votre application (ex: "Odoo Integration")
5. Configurez les permissions API (Admin API access scopes) :
   - `read_products`, `write_products`
   - `read_orders`, `write_orders`
   - `read_customers`, `write_customers`
   - `read_inventory`, `write_inventory`
   - `read_fulfillments`, `write_fulfillments`
6. Installez l'application et r√©cup√©rez :
   - API Key
   - API Secret
   - Access Token

### √âtape 2 : Configurer l'instance dans Odoo

1. Dans Odoo, allez dans **Shopify > Configuration > Instances**
2. Cliquez sur **Cr√©er**
3. Cliquez sur **Setup Wizard** pour lancer l'assistant de configuration :

#### **√âtape 1 - Credentials**
- Nom de l'instance : `Ma Boutique Shopify`
- Shop URL : `monmagasin.myshopify.com`
- API Key : `votre_api_key`
- API Secret : `votre_api_secret`
- Access Token : `votre_access_token`
- Cliquez sur **Test Connection** pour v√©rifier
- Cliquez sur **Suivant**

#### **√âtape 2 - Configuration**
- Cochez les options souhait√©es :
  - ‚úÖ Auto Import Orders
  - ‚úÖ Auto Import Customers
  - ‚úÖ Auto Sync Stock
  - ‚úÖ Auto Create Invoices
- Cliquez sur **Suivant**

#### **√âtape 3 - Mapping**
- S√©lectionnez l'entrep√¥t par d√©faut
- S√©lectionnez la liste de prix par d√©faut
- S√©lectionnez les conditions de paiement
- S√©lectionnez l'√©quipe commerciale
- Cliquez sur **Suivant**

#### **√âtape 4 - Webhooks**
- Cochez **Setup Webhooks**
- Cliquez sur **Terminer**

### √âtape 3 : Premi√®re synchronisation

1. Allez dans **Shopify > Tools > Synchronize**
2. S√©lectionnez votre instance
3. Cochez les √©l√©ments √† synchroniser :
   - ‚úÖ Sync Products
   - ‚úÖ Sync Orders
   - ‚úÖ Sync Customers
4. Cliquez sur **Sync All**

## üîÑ Utilisation

### Import/Export de produits

#### Import depuis Shopify
```
Shopify > Tools > Import/Export
- Op√©ration : Import Products
- Instance : [S√©lectionner votre instance]
- Create Queue Job : Oui (recommand√©)
- Ex√©cuter
```

#### Export vers Shopify
```
Shopify > Tools > Import/Export
- Op√©ration : Export Products
- S√©lectionner les produits √† exporter
- Ex√©cuter
```

### Gestion des commandes

Les commandes sont import√©es automatiquement via webhooks ou cron jobs.

Pour forcer une synchronisation :
```
Shopify > Tools > Synchronize
- Sync Orders uniquement
```

### Monitoring

#### Dashboard
```
Shopify > Dashboard
- Vue d'ensemble en temps r√©el
- Statistiques de synchronisation
- Erreurs r√©centes
```

#### Logs
```
Shopify > Operations > Logs
- Filtres par type d'op√©ration
- Filtres par statut
- Recherche avanc√©e
```

#### Queue
```
Shopify > Operations > Queue
- Jobs en attente
- Jobs en cours
- Jobs √©chou√©s avec retry
```

## üîß Configuration avanc√©e

### Cron Jobs

Les t√¢ches planifi√©es suivantes sont configur√©es par d√©faut :

| T√¢che | Fr√©quence | Description |
|-------|-----------|-------------|
| Process Queue Jobs | 5 minutes | Traite les jobs en file d'attente |
| Sync Orders | 1 heure | Synchronise les commandes |
| Sync Products | Quotidien (2h) | Synchronise les produits |
| Sync Customers | Quotidien (3h) | Synchronise les clients |
| Sync Stock | 30 minutes | Synchronise les stocks |
| Cleanup Logs | Hebdomadaire | Nettoie les logs > 90 jours |
| Error Notifications | Quotidien (9h) | Envoie les notifications d'erreurs |

Pour modifier : **Settings > Technical > Automation > Scheduled Actions**

### Webhooks

Les webhooks suivants sont cr√©√©s automatiquement :

- `orders/create` : Nouvelle commande
- `orders/updated` : Commande mise √† jour
- `orders/cancelled` : Commande annul√©e
- `orders/fulfilled` : Commande livr√©e
- `products/create` : Nouveau produit
- `products/update` : Produit mis √† jour
- `customers/create` : Nouveau client
- `refunds/create` : Nouveau remboursement

URL de base : `https://votre-domaine.com/shopify/webhook/`

## üêõ D√©pannage

### Erreur : "Connection failed"
- V√©rifiez que l'URL Shopify se termine par `.myshopify.com`
- V√©rifiez que l'Access Token est valide
- V√©rifiez les permissions API dans Shopify

### Les commandes ne s'importent pas
- V√©rifiez que "Auto Import Orders" est activ√©
- V√©rifiez les webhooks dans Shopify Admin
- Consultez les logs : **Shopify > Operations > Logs**

### Les stocks ne se synchronisent pas
- V√©rifiez que "Auto Sync Stock" est activ√©
- V√©rifiez que les produits sont li√©s (SKU matching)
- V√©rifiez les logs de synchronisation

### Les webhooks ne fonctionnent pas
- V√©rifiez que votre serveur Odoo est accessible depuis Internet
- V√©rifiez le Webhook Secret dans la configuration
- Testez avec : **Shopify > Operations > Webhooks > Test Webhook**

## üìù Structure du module

```
shopify_integration/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ __manifest__.py
‚îú‚îÄ‚îÄ CLAUDE.md                    # Instructions projet
‚îú‚îÄ‚îÄ README.md                    # Ce fichier
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ shopify_instance.py      # Configuration instances
‚îÇ   ‚îú‚îÄ‚îÄ shopify_product.py       # Gestion produits
‚îÇ   ‚îú‚îÄ‚îÄ shopify_order.py         # Gestion commandes
‚îÇ   ‚îú‚îÄ‚îÄ shopify_customer.py      # Gestion clients
‚îÇ   ‚îú‚îÄ‚îÄ shopify_webhook.py       # Webhooks
‚îÇ   ‚îú‚îÄ‚îÄ shopify_queue.py         # File d'attente
‚îÇ   ‚îî‚îÄ‚îÄ shopify_log.py           # Logs
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ webhooks.py              # Contr√¥leur webhooks
‚îú‚îÄ‚îÄ wizards/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ onboarding_wizard.py     # Assistant configuration
‚îÇ   ‚îú‚îÄ‚îÄ import_export_wizard.py  # Import/Export
‚îÇ   ‚îî‚îÄ‚îÄ sync_wizard.py           # Synchronisation
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îú‚îÄ‚îÄ shopify_instance_views.xml
‚îÇ   ‚îú‚îÄ‚îÄ shopify_product_views.xml
‚îÇ   ‚îú‚îÄ‚îÄ shopify_order_views.xml
‚îÇ   ‚îú‚îÄ‚îÄ shopify_customer_views.xml
‚îÇ   ‚îú‚îÄ‚îÄ shopify_webhook_views.xml
‚îÇ   ‚îú‚îÄ‚îÄ shopify_queue_views.xml
‚îÇ   ‚îú‚îÄ‚îÄ shopify_log_views.xml
‚îÇ   ‚îú‚îÄ‚îÄ onboarding_wizard_views.xml
‚îÇ   ‚îú‚îÄ‚îÄ import_export_wizard_views.xml
‚îÇ   ‚îú‚îÄ‚îÄ sync_wizard_views.xml
‚îÇ   ‚îî‚îÄ‚îÄ menu_views.xml
‚îú‚îÄ‚îÄ security/
‚îÇ   ‚îú‚îÄ‚îÄ ir.model.access.csv
‚îÇ   ‚îî‚îÄ‚îÄ security.xml
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ ir_cron.xml              # T√¢ches planifi√©es
‚îÇ   ‚îú‚îÄ‚îÄ queue_job.xml            # Configuration queue
‚îÇ   ‚îî‚îÄ‚îÄ demo.xml                 # Donn√©es d√©mo
‚îî‚îÄ‚îÄ static/
    ‚îú‚îÄ‚îÄ description/
    ‚îÇ   ‚îú‚îÄ‚îÄ icon.png
    ‚îÇ   ‚îú‚îÄ‚îÄ banner.png
    ‚îÇ   ‚îî‚îÄ‚îÄ index.html
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ js/
        ‚îÇ   ‚îî‚îÄ‚îÄ shopify_dashboard.js
        ‚îú‚îÄ‚îÄ css/
        ‚îÇ   ‚îî‚îÄ‚îÄ shopify.css
        ‚îî‚îÄ‚îÄ xml/
            ‚îî‚îÄ‚îÄ shopify_dashboard.xml
```

## üîê S√©curit√©

### Groupes de s√©curit√©

- **Shopify User** : Lecture seule sur toutes les donn√©es
- **Shopify Manager** : Acc√®s complet (CRUD)

### Multi-soci√©t√©s

Le module supporte le multi-soci√©t√©s :
- Chaque instance Shopify est li√©e √† une soci√©t√©
- Les donn√©es sont automatiquement filtr√©es par soci√©t√©
- Les utilisateurs ne voient que les donn√©es de leurs soci√©t√©s

## ü§ù Support

Pour toute question ou probl√®me :
1. Consultez la documentation dans le dossier `static/description/`
2. V√©rifiez les logs dans **Shopify > Operations > Logs**
3. Cr√©ez une issue sur le repository

## üìú License

LGPL-3

## üë®‚Äçüíª D√©veloppement

### Tests

```bash
# Lancer les tests
python -m pytest tests/

# V√©rifier le code
pylint models/ controllers/ wizards/
```

### Contribuer

1. Forkez le projet
2. Cr√©ez votre branche (`git checkout -b feature/AmazingFeature`)
3. Committez vos changements (`git commit -m 'Add some AmazingFeature'`)
4. Pushez vers la branche (`git push origin feature/AmazingFeature`)
5. Ouvrez une Pull Request

## üó∫Ô∏è Roadmap

- [ ] Support Shopify Plus
- [ ] Gestion des promotions
- [ ] Analytics avanc√©es
- [ ] Support multi-devises avanc√©
- [ ] Import des avis clients
- [ ] Gestion des abonnements
- [ ] Support des metafields personnalis√©s

## üìö Ressources

- [Documentation Odoo 16](https://www.odoo.com/documentation/16.0/)
- [Shopify API Documentation](https://shopify.dev/docs/api)
- [Repository GitHub](https://github.com/naashmtp/odoo-shopify-connector)

---

**Fait avec ‚ù§Ô∏è pour casser le prix du march√©**